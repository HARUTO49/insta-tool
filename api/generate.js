
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { shopName, genre, menuName, points, target } = req.body;

  const prompt = `あなたはInstagramのプロのコピーライターです。
以下の情報をもとに、飲食店のInstagram投稿文を作成してください。

【お店の情報】
- 店名：${shopName}
- ジャンル：${genre}
- メニュー：${menuName}
- こだわりポイント：${points}
- ターゲット・雰囲気：${target}

【作成ルール】
- 200〜280文字程度の日本語で書く
- 読んだ人が「行きたい！」「食べたい！」と思う魅力的な文章
- 絵文字を3〜5個使って親しみやすく
- 最後にハッシュタグを5〜8個つける（岡山関連も含める）
- 改行を上手く使って読みやすく

投稿文のみ出力してください。`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': process.env.ANTHROPIC_API_KEY,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{ role: 'user', content: prompt }]
      })
    });

    const data = await response.json();
    const text = data.content?.[0]?.text;
    res.status(200).json({ text });
  } catch (e) {
    res.status(500).json({ error: '生成に失敗しました' });
  }
}
